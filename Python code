import mysql.connector

# Database Connection
db = mysql.connector.connect(
    host="localhost",
    user="root",
    password="",
    database="meenakshi"
)

cursor = db.cursor()

# 1. Create New Bank Account
def create_account():
    acc_no = int(input("Enter Account Number: "))
    name = input("Enter Account Holder Name: ")
    balance = float(input("Enter Opening Balance: "))

    query = "INSERT INTO accounts (account_number, name, balance) VALUES (%s, %s, %s)"
    cursor.execute(query, (acc_no, name, balance))
    db.commit()

    print("\n‚úî Account Created Successfully!\n")

# 2. Deposit Money
def deposit():
    acc_no = int(input("Enter Account Number: "))
    amount = float(input("Enter Amount to Deposit: "))

    # Check if account exists
    cursor.execute("SELECT balance FROM accounts WHERE account_number=%s", (acc_no,))
    result = cursor.fetchone()

    if not result:
        print("\n‚ùå Account Not Found!\n")
        return

    # Deposit amount
    cursor.execute(
        "UPDATE accounts SET balance = balance + %s WHERE account_number = %s",
        (amount, acc_no)
    )

    cursor.execute(
        "INSERT INTO transactions (account_number, type, amount) VALUES (%s, %s, %s)",
        (acc_no, "Deposit", amount)
    )
    db.commit()

    print("\n‚úî Amount Deposited Successfully!\n")

# 3. Withdraw Money
def withdraw():
    acc_no = int(input("Enter Account Number: "))
    amount = float(input("Enter Amount to Withdraw: "))

    cursor.execute("SELECT balance FROM accounts WHERE account_number=%s", (acc_no,))
    result = cursor.fetchone()

    if not result:
        print("\n‚ùå Account Not Found!\n")
        return

    current_balance = result[0]

    if amount > current_balance:
        print("\n‚ùå Insufficient Balance!\n")
        return

    cursor.execute(
        "UPDATE accounts SET balance = balance - %s WHERE account_number = %s",
        (amount, acc_no)
    )

    cursor.execute(
        "INSERT INTO transactions (account_number, type, amount) VALUES (%s, %s, %s)",
        (acc_no, "Withdraw", amount)
    )
    db.commit()

    print("\n‚úî Withdrawal Successful!\n")

# 4. View Balance
def view_balance():
    acc_no = int(input("Enter Account Number: "))

    cursor.execute("SELECT balance FROM accounts WHERE account_number=%s", (acc_no,))
    result = cursor.fetchone()

    if result:
        print(f"\nüí∞ Current Balance: ‚Çπ{result[0]}\n")
    else:
        print("\n‚ùå Account Not Found!\n")

# 5. Transaction History
def transaction_history():
    acc_no = int(input("Enter Account Number: "))

    cursor.execute("SELECT type, amount, date FROM transactions WHERE account_number=%s", (acc_no,))
    rows = cursor.fetchall()

    if rows:
        print("\n----- Transaction History -----\n")
        for t in rows:
            print(f"Type: {t[0]} | Amount: ‚Çπ{t[1]} | Date: {t[2]}")
        print()
    else:
        print("\n‚ùå No Transactions Found\n")

# Main Menu
def main():
    while True:
        print("=== Banking System ===")
        print("1. Create Account")
        print("2. Deposit Money")
        print("3. Withdraw Money")
        print("4. View Balance")
        print("5. Transaction History")
        print("6. Exit")

        choice = input("Choose an option: ")

        if choice == "1":
            create_account()
        elif choice == "2":
            deposit()
        elif choice == "3":
            withdraw()
        elif choice == "4":
            view_balance()
        elif choice == "5":
            transaction_history()
        elif choice == "6":
            print("Exiting Program...")
            break
        else:
            print("Invalid Choice! Try Again.\n")

main()
